{#<!DOCTYPE html>#}
{#<html lang="fa">#}
{#<head>#}
{#  <meta charset="UTF-8">#}
{#  <meta name="viewport" content="width=device-width, initial-scale=1.0">#}
{#  <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</title>#}
{#  <script src="https://cdn.tailwindcss.com"></script>#}
{#    <script src="common.js"></script>#}
{#  <link href="/static/css/style.css" rel="stylesheet">#}
{#</head>#}
{#<body class="bg-gray-100">#}
{#  <div class="container mx-auto p-6">#}
{#    <div class="flex justify-between">#}
{#      <a href="http://127.0.0.1:8000/mypro/" class="bg-blue-500 text-white p-2 rounded">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</a>#}
{#      <a href="http://127.0.0.1:8000/postha/" class="bg-blue-500 text-white p-2 rounded">Ù¾Ø³Øªâ€ŒÙ‡Ø§</a>#}
{#      <a href="http://127.0.0.1:8000/exp/" class="bg-blue-500 text-white p-2 rounded">Ø§Ú©Ø³Ù¾Ù„ÙˆØ±</a>#}
{#      <a href="http://127.0.0.1:8000/out/" class="bg-red-500 text-white p-2 rounded">Ø®Ø±ÙˆØ¬</a>#}
{#    </div>#}
{#          <!-- Ø¨Ø®Ø´ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ú©Ø³Ù¾Ù„ÙˆØ± -->#}
{#    <div id="explore-section" class="mt-10">#}
{#  <div class="mb-6">#}
{#    <input id="search-input" type="text" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ ÛŒÙˆØ²Ø±Ù†ÛŒÙ…" class="p-2 rounded border w-full">#}
{#  </div>#}
{#  <div id="search-results" class="space-y-4">#}
{#    <!-- Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->#}
{#  </div>#}
{#</div>#}
{#<!-- ğŸ”¹ Ø¨Ø®Ø´ Ù†Ù…Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ (Ù…Ø®ÙÛŒ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§) -->#}
{#<div id="profile-section" class="hidden bg-white p-6 rounded shadow-md mt-6">#}
{#    <button id="back-to-search" class="bg-gray-500 text-white px-4 py-2 rounded mb-4">Ø¨Ø§Ø²Ú¯Ø´Øª</button>#}
{#    <div class="flex items-center space-x-4">#}
{#        <img id="profile-avatar" src="" alt="Avatar" class="w-24 h-24 rounded-full">#}
{#        <div>#}
{#            <h2 id="profile-username" class="text-xl font-semibold"></h2>#}
{#            <p id="profile-fullname" class="text-gray-700"></p>#}
{#            <p id="profile-age" class="text-gray-600"></p>#}
{#            <p id="profile-bio" class="text-gray-800"></p>#}
{#        </div>#}
{#    </div>#}
{#</div>#}
{##}
{##}
{#      <script>#}
{#     // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ `user_id` Ø§Ø² Access Token#}
{#    function parseJwt(token) {#}
{#        try {#}
{#            return JSON.parse(atob(token.split('.')[1])); // Ø¨Ø®Ø´ Payload ØªÙˆÚ©Ù†#}
{#        } catch (e) {#}
{#            return null;#}
{#        }#}
{#    }#}
{##}
{#    document.addEventListener('DOMContentLoaded', async () => {#}
{#      const accessToken = localStorage.getItem("access_token");#}
{##}
{#      // Ú†Ú© Ú©Ø±Ø¯Ù† ÙˆØ¶Ø¹ÛŒØª Ù„Ø§Ú¯ÛŒÙ†#}
{#      if (!accessToken) {#}
{#        document.getElementById('error-message').classList.remove('hidden');#}
{#        return;#}
{#      }#}
{##}
{#      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ `user_id` Ø§Ø² ØªÙˆÚ©Ù†#}
{#      const userData = parseJwt(accessToken);#}
{#      const userId = userData ? userData.user_id : null;#}
{##}
{#      if (!userId) {#}
{#        console.error("Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯!");#}
{#        document.getElementById('error-message').classList.remove('hidden');#}
{#        return;#}
{##}
{#      }#}
{#async function displayUserProfile(userId) {#}
{#    try {#}
{#        const response = await fetch(`http://127.0.0.1:8000/profile/${userId}/`, {#}
{#            method: "GET",#}
{#            headers: {#}
{#                "Authorization": `Bearer ${localStorage.getItem("access_token")}`,#}
{#                "Content-Type": "application/json"#}
{#            }#}
{#        });#}
{##}
{#        if (!response.ok) {#}
{#            throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø±ÙˆÙØ§ÛŒÙ„");#}
{#        }#}
{##}
{#        const userProfile = await response.json();#}
{##}
{#        // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± ØµÙØ­Ù‡#}
{#        document.getElementById("profile-avatar").src = userProfile.avatar || 'https://via.placeholder.com/150';#}
{#        document.getElementById("profile-username").textContent = `Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: ${userProfile.username}`;#}
{#        document.getElementById("profile-fullname").textContent = `Ù†Ø§Ù… Ú©Ø§Ù…Ù„: ${userProfile.full_name}`;#}
{#        document.getElementById("profile-age").textContent = `Ø³Ù†: ${userProfile.age ? userProfile.age : "Ù†Ø§Ù…Ø´Ø®Øµ"}`;#}
{#        document.getElementById("profile-bio").textContent = `Ø¨ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ: ${userProfile.bio ? userProfile.bio : "Ø¨ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"}`;#}
{##}
{#        // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ùˆ Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¬Ø³ØªØ¬Ùˆ#}
{#        document.getElementById("profile-section").classList.remove("hidden");#}
{#        document.getElementById("explore-section").classList.add("hidden");#}
{##}
{#    } catch (error) {#}
{#        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø±ÙˆÙØ§ÛŒÙ„:", error);#}
{#    }#}
{#}#}
{##}
{#// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø¬Ø³ØªØ¬Ùˆ#}
{#document.getElementById("back-to-search").addEventListener("click", () => {#}
{#    document.getElementById("profile-section").classList.add("hidden");#}
{#    document.getElementById("explore-section").classList.remove("hidden");#}
{#});#}
{##}
{##}
{#// Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¯Ø± ØµÙØ­Ù‡#}
{#function updateProfileUI(profile) {#}
{#    const profileContainer = document.getElementById("profile-section");#}
{##}
{#    profileContainer.innerHTML = `#}
{#        <div class="bg-white p-6 rounded-lg shadow-md">#}
{#            <img src="${profile.avatar || 'https://via.placeholder.com/150'}" alt="Avatar" class="w-24 h-24 rounded-full mx-auto">#}
{#            <h2 class="text-center text-2xl mt-2">${profile.full_name || profile.username}</h2>#}
{#            <p class="text-center text-gray-600">${profile.bio || "Ø¨ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª"}</p>#}
{#            <p class="text-center text-sm text-gray-500">Ø³Ù†: ${profile.age || "?"}</p>#}
{#            <button onclick="closeProfile()" class="mt-4 bg-red-500 text-white px-4 py-2 rounded w-full">Ø¨Ø³ØªÙ†</button>#}
{#        </div>#}
{#    `;#}
{##}
{#    profileContainer.classList.remove("hidden");  // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„#}
{#}#}
{##}
{#// Ø¨Ø³ØªÙ† Ù¾Ø±ÙˆÙØ§ÛŒÙ„#}
{#function closeProfile() {#}
{#    document.getElementById("profile-section").classList.add("hidden");#}
{#}#}
{##}
{#// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø±Ø§ÛŒ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ "Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„"#}
{#document.addEventListener("click", (event) => {#}
{#    if (event.target.classList.contains("view-profile-btn")) {#}
{#        event.preventDefault();#}
{#        const userId = event.target.dataset.userId;#}
{#        displayUserProfile(userId);#}
{#    }#}
{#});#}
{#// Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ ÛŒÙˆØ²Ø±Ù†ÛŒÙ…#}
{#document.getElementById('search-input').addEventListener('input', async (e) => {#}
{#    const query = e.target.value.trim();#}
{#    if (query.length < 3) {#}
{#        document.getElementById('search-results').innerHTML = '';#}
{#        return;#}
{#    }#}
{##}
{#    try {#}
{#        const response = await fetch(`http://127.0.0.1:8000/search/?search=${query}`, {#}
{#            method: "GET",#}
{#            headers: {#}
{#                "Authorization": `Bearer ${localStorage.getItem("access_token")}`,#}
{#                "Content-Type": "application/json"#}
{#            }#}
{#        });#}
{##}
{#        if (!response.ok) {#}
{#            throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ');#}
{#        }#}
{##}
{#        const users = await response.json();#}
{#        displaySearchResults(users);#}
{#    } catch (error) {#}
{#        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ:', error);#}
{#    }#}
{#});#}
{##}
{#// Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± ØµÙØ­Ù‡#}
{#function displaySearchResults(users) {#}
{#    const resultsContainer = document.getElementById('search-results');#}
{#    resultsContainer.innerHTML = ''; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ù‚Ø¨Ù„ÛŒ#}
{##}
{#    users.forEach(user => {#}
{#        const avatarUrl = user.profile?.avatar || 'https://via.placeholder.com/150';#}
{##}
{#        const resultItem = document.createElement('div');#}
{#        resultItem.classList.add('flex', 'items-center', 'space-x-4', 'border-b', 'py-2');#}
{##}
{#        resultItem.innerHTML = `#}
{#            <img src="${avatarUrl}" alt="Avatar" class="rounded-full w-12 h-12">#}
{#            <div>#}
{#                <h3 class="text-lg">${user.username}</h3>#}
{#                <button class="text-blue-500 view-profile-btn" data-user-id="${user.id}">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</button>#}
{#            </div>#}
{#        `;#}
{#        resultsContainer.appendChild(resultItem);#}
{#    });#}
{#}#}
{##}
{#// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„#}
{#document.addEventListener("click", (event) => {#}
{#    if (event.target.classList.contains("view-profile-btn")) {#}
{#        event.preventDefault();#}
{#        const userId = event.target.dataset.userId;#}
{#        displayUserProfile(userId);#}
{#    }#}
{#    // Ø¯Ú©Ù…Ù‡ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„#}
{#const viewProfileBtn = resultItem.querySelector('.view-profile-btn');#}
{#viewProfileBtn.addEventListener('click', (e) => {#}
{#    e.preventDefault(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØºÛŒÛŒØ± Ù„ÛŒÙ†Ú©#}
{#    const userId = user.id;#}
{#    window.location.href = `http://127.0.0.1:8000/prosec?user_id=${userId}`; // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„#}
{#});#}
{##}
{#});})#}
{##}
{#    // Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ ÛŒÙˆØ²Ø±Ù†ÛŒÙ…#}
{#    document.getElementById('search-input').addEventListener('input', async (e) => {#}
{#    const query = e.target.value;#}
{#    if (query.length < 3) {#}
{#      document.getElementById('search-results').innerHTML = '';#}
{#      return;#}
{#    }#}
{##}
{#    try {#}
{#      const response = await fetch(`http://127.0.0.1:8000/search/?search=${query}`, {  // Ø§ØµÙ„Ø§Ø­ URL#}
{#        method: "GET",#}
{#        headers: {#}
{#          "Authorization": `Bearer ${localStorage.getItem("access_token")}`,#}
{#          "Content-Type": "application/json"#}
{#        }#}
{#      });#}
{##}
{#      if (response.ok) {#}
{#        const users = await response.json();#}
{#        displaySearchResults(users);#}
{#      } else {#}
{#        throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ');#}
{#      }#}
{#    } catch (error) {#}
{#      console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ:', error);#}
{#    }#}
{#  });#}
{##}
{#  // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ#}
{#  function displaySearchResults(users) {#}
{#    const resultsContainer = document.getElementById('search-results');#}
{#    resultsContainer.innerHTML = ''; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ù‚Ø¨Ù„ÛŒ#}
{##}
{#    users.forEach(user => {#}
{#      const avatarUrl = user.profile && user.profile.avatar ? user.profile.avatar : 'https://via.placeholder.com/150';  // Ø§Ø² ØªØµÙˆÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†#}
{##}
{#      const resultItem = document.createElement('div');#}
{#      resultItem.classList.add('flex', 'items-center', 'space-x-4', 'border-b', 'py-2');#}
{#      resultItem.innerHTML = `#}
{#        <img src="${avatarUrl}" alt="Avatar" class="rounded-full w-12 h-12">#}
{#        <div>#}
{#          <h3 class="text-lg">${user.username}</h3>#}
{#          <a href="prosec?user_id=${user.id}" class="text-blue-500 view-profile-btn" data-user-id="${user.id}">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</a> <!-- ØªØºÛŒÛŒØ± Ù„ÛŒÙ†Ú© Ø¨Ù‡ Ø¯Ú©Ù…Ù‡ -->#}
          {#<button class="bg-blue-500 text-white p-2 rounded follow-btn" data-user-id="${user.id}">ÙØ§Ù„Ùˆ</button>#}
{#        </div>#}
{#      `;#}
{#      resultsContainer.appendChild(resultItem);#}
{##}
      {#// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª ÙØ§Ù„Ùˆ Ú©Ø±Ø¯Ù†#}
      {#const followBtn = resultItem.querySelector('.follow-btn');#}
      {#followBtn.addEventListener('click', () => handleFollow(user.id));#}
{##}
{#      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„#}
{#      const viewProfileBtn = resultItem.querySelector('.view-profile-btn');#}
{#      viewProfileBtn.addEventListener('click', (e) => {#}
{#        e.preventDefault(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØºÛŒÛŒØ± Ù„ÛŒÙ†Ú©#}
{#        displayUserProfile(user.id); // Ù†Ù…Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±#}
{#      });#}
{#    });#}
{#  }});#}
{#async function displayUserProfile(userId) {#}
{#    try {#}
{#      const response = await fetch(`http://127.0.0.1:8000/profile/${userId}/`, {#}
{#        method: 'GET',#}
{#        headers: {#}
{#          "Authorization": `Bearer ${localStorage.getItem("access_token")}`,#}
{#          "Content-Type": "application/json"#}
{#        }#}
{#      });#}
{##}
{#      if (!response.ok) throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±");#}
{##}
{#      const user = await response.json();#}
{#      const profile = user.profile;  // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÙØ§ÛŒÙ„#}
{##}
{#      document.getElementById('profile-fullname').textContent = profile.full_name || "Ù†Ø§Ù… Ù†Ø§Ù…Ø´Ø®Øµ";#}
{#      document.getElementById('profile-avatar').src = profile.avatar || 'https://via.placeholder.com/150';#}
{#      document.getElementById('profile-username').textContent = `@${profile.username}`;#}
{#      document.getElementById('profile-bio').textContent = profile.bio || "Ø¨ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡";#}
{#      document.getElementById('profile-age').textContent = profile.age ? `Ø³Ù†: ${profile.age}` : "Ø³Ù† ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡";#}
{##}
{#      // Ù†Ù…Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ùˆ Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø§Ú©Ø³Ù¾Ù„ÙˆØ±#}
{#      document.getElementById('explore-section').classList.add('hidden');#}
{#      document.getElementById('profile-section').classList.remove('hidden');#}
{##}
{#    } catch (error) {#}
{#      console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÙØ§ÛŒÙ„:", error);#}
{#    }#}
{#  }#}
{#      </script>#}
{##}
{#</body>#}
{#</html>#}


<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="common.js"></script>
  <link href="/static/css/style.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-6">
    <div class="flex justify-between">
      <a href="http://127.0.0.1:8000/mypro/" class="bg-blue-500 text-white p-2 rounded">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</a>
      <a href="http://127.0.0.1:8000/postha/" class="bg-blue-500 text-white p-2 rounded">Ù¾Ø³Øªâ€ŒÙ‡Ø§</a>
      <a href="http://127.0.0.1:8000/exp/" class="bg-blue-500 text-white p-2 rounded">Ø§Ú©Ø³Ù¾Ù„ÙˆØ±</a>
      <a href="http://127.0.0.1:8000/out/" class="bg-red-500 text-white p-2 rounded">Ø®Ø±ÙˆØ¬</a>
    </div>

    <!-- Ø¨Ø®Ø´ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ú©Ø³Ù¾Ù„ÙˆØ± -->
    <div id="explore-section" class="mt-10">
      <div class="mb-6">
        <input id="search-input" type="text" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ ÛŒÙˆØ²Ø±Ù†ÛŒÙ…" class="p-2 rounded border w-full">
      </div>
      <div id="search-results" class="space-y-4">
        <!-- Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
      </div>
    </div>

    <!-- ğŸ”¹ Ø¨Ø®Ø´ Ù†Ù…Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ (Ù…Ø®ÙÛŒ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§) -->
    <div id="profile-section" class="hidden bg-white p-6 rounded shadow-md mt-6">
      <button id="back-to-search" class="bg-gray-500 text-white px-4 py-2 rounded mb-4">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
      <div class="flex items-center space-x-4">
        <img id="profile-avatar" src="" alt="Avatar" class="w-24 h-24 rounded-full">
        <div>
          <h2 id="profile-username" class="text-xl font-semibold"></h2>
          <p id="profile-fullname" class="text-gray-700"></p>
          <p id="profile-age" class="text-gray-600"></p>
          <p id="profile-bio" class="text-gray-800"></p>
        </div>
      </div>
    </div>

    <script>
      // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ `user_id` Ø§Ø² Access Token
      function parseJwt(token) {
          try {
              return JSON.parse(atob(token.split('.')[1])); // Ø¨Ø®Ø´ Payload ØªÙˆÚ©Ù†
          } catch (e) {
              return null;
          }
      }

      document.addEventListener('DOMContentLoaded', async () => {
        const accessToken = localStorage.getItem("access_token");

        // Ú†Ú© Ú©Ø±Ø¯Ù† ÙˆØ¶Ø¹ÛŒØª Ù„Ø§Ú¯ÛŒÙ†
        if (!accessToken) {
          document.getElementById('error-message').classList.remove('hidden');
          return;
        }

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ `user_id` Ø§Ø² ØªÙˆÚ©Ù†
        const userData = parseJwt(accessToken);
        const userId = userData ? userData.user_id : null;

        if (!userId) {
          console.error("Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯!");
          document.getElementById('error-message').classList.remove('hidden');
          return;
        }

        // Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
        document.getElementById('search-input').addEventListener('input', async (e) => {
          const query = e.target.value.trim();
          if (query.length < 3) {
            document.getElementById('search-results').innerHTML = '';
            return;
          }

          try {
            const response = await fetch(`http://127.0.0.1:8000/search/?search=${query}`, {
              method: "GET",
              headers: {
                  "Authorization": `Bearer ${accessToken}`,
                  "Content-Type": "application/json"
              }
            });

            if (!response.ok) {
              throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ');
            }

            const users = await response.json();
            displaySearchResults(users);
          } catch (error) {
            console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ:', error);
          }
        });

        // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± ØµÙØ­Ù‡
        function displaySearchResults(users) {
          const resultsContainer = document.getElementById('search-results');
          resultsContainer.innerHTML = ''; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ù‚Ø¨Ù„ÛŒ

          users.forEach(user => {
            const avatarUrl = user.profile?.avatar || 'https://via.placeholder.com/150';

            const resultItem = document.createElement('div');
            resultItem.classList.add('flex', 'items-center', 'space-x-4', 'border-b', 'py-2');

            resultItem.innerHTML = `
              <img src="${avatarUrl}" alt="Avatar" class="rounded-full w-12 h-12">
              <div>
                <h3 class="text-lg">${user.username}</h3>
                <button class="text-blue-500 view-profile-btn" data-user-id="${user.id}">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</button>
              </div>
            `;
            resultsContainer.appendChild(resultItem);
          });
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±
        async function displayUserProfile(userId) {
          try {
              const response = await fetch(`http://127.0.0.1:8000/profile/${userId}/`, {
                  method: "GET",
                  headers: {
                      "Authorization": `Bearer ${localStorage.getItem("access_token")}`,
                      "Content-Type": "application/json"
                  }
              });

              if (!response.ok) {
                  throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø±ÙˆÙØ§ÛŒÙ„");
              }

              const userProfile = await response.json();

              // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± ØµÙØ­Ù‡
              document.getElementById("profile-avatar").src = userProfile.avatar || 'https://via.placeholder.com/150';
              document.getElementById("profile-username").textContent = `Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: ${userProfile.username}`;
              document.getElementById("profile-fullname").textContent = `Ù†Ø§Ù… Ú©Ø§Ù…Ù„: ${userProfile.full_name}`;
              document.getElementById("profile-age").textContent = `Ø³Ù†: ${userProfile.age ? userProfile.age : "Ù†Ø§Ù…Ø´Ø®Øµ"}`;
              document.getElementById("profile-bio").textContent = `Ø¨ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ: ${userProfile.bio ? userProfile.bio : "Ø¨ÛŒÙˆÚ¯Ø±Ø§ÙÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"}`;

              // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ùˆ Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¬Ø³ØªØ¬Ùˆ
              document.getElementById("profile-section").classList.remove("hidden");
              document.getElementById("explore-section").classList.add("hidden");

          } catch (error) {
              console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø±ÙˆÙØ§ÛŒÙ„:", error);
          }
        }

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø¬Ø³ØªØ¬Ùˆ
        document.getElementById("back-to-search").addEventListener("click", () => {
          document.getElementById("profile-section").classList.add("hidden");
          document.getElementById("explore-section").classList.remove("hidden");
        });

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„
        document.addEventListener("click", (event) => {
          if (event.target.classList.contains("view-profile-btn")) {
              event.preventDefault();
              const userId = event.target.dataset.userId;
              // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„
              window.location.href = `http://127.0.0.1:8000/prosec?user_id=${userId}`;
          }
        });

      });
    </script>
  </div>
</body>
</html>
